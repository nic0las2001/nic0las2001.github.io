{"version":3,"file":"theme.min.js","sources":["../../../_javascript/modules/theme.js"],"sourcesContent":["/**\n * Theme management class\n *\n * To reduce flickering during page load, this script should be loaded synchronously.\n */\nclass Theme {\n  static #modeKey = 'mode';\n  static #modeAttr = 'data-mode';\n  static #darkMedia = window.matchMedia('(prefers-color-scheme: dark)');\n  static switchable = !document.documentElement.hasAttribute(this.#modeAttr);\n\n  static get DARK() {\n    return 'dark';\n  }\n\n  static get LIGHT() {\n    return 'light';\n  }\n\n  /**\n   * @returns {string} Theme mode identifier\n   */\n  static get ID() {\n    return 'theme-mode';\n  }\n\n  /**\n   * Gets the current visual state of the theme.\n   *\n   * @returns {string} The current visual state, either the mode if it exists,\n   *                   or the system dark mode state ('dark' or 'light').\n   */\n  static get visualState() {\n    if (this.#hasMode) {\n      return this.#mode;\n    } else {\n      return this.#sysDark ? this.DARK : this.LIGHT;\n    }\n  }\n\n  static get #mode() {\n    return (\n      sessionStorage.getItem(this.#modeKey) ||\n      document.documentElement.getAttribute(this.#modeAttr)\n    );\n  }\n\n  static get #isDarkMode() {\n    return this.#mode === this.DARK;\n  }\n\n  static get #hasMode() {\n    return this.#mode !== null;\n  }\n\n  static get #sysDark() {\n    return this.#darkMedia.matches;\n  }\n\n  /**\n   * Maps theme modes to provided values\n   * @param {string} light Value for light mode\n   * @param {string} dark Value for dark mode\n   * @returns {Object} Mapped values\n   */\n  static getThemeMapper(light, dark) {\n    return {\n      [this.LIGHT]: light,\n      [this.DARK]: dark\n    };\n  }\n\n  /**\n   * Initializes the theme based on system preferences or stored mode\n   */\n  static init() {\n    if (!this.switchable) {\n      return;\n    }\n\n    this.#darkMedia.addEventListener('change', () => {\n      const lastMode = this.#mode;\n      this.#clearMode();\n\n      if (lastMode !== this.visualState) {\n        this.#notify();\n      }\n    });\n\n    if (!this.#hasMode) {\n      return;\n    }\n\n    if (this.#isDarkMode) {\n      this.#setDark();\n    } else {\n      this.#setLight();\n    }\n  }\n\n  /**\n   * Flips the current theme mode\n   */\n  static flip() {\n    if (this.#hasMode) {\n      this.#clearMode();\n    } else {\n      this.#sysDark ? this.#setLight() : this.#setDark();\n    }\n    this.#notify();\n  }\n\n  static #setDark() {\n    document.documentElement.setAttribute(this.#modeAttr, this.DARK);\n    sessionStorage.setItem(this.#modeKey, this.DARK);\n  }\n\n  static #setLight() {\n    document.documentElement.setAttribute(this.#modeAttr, this.LIGHT);\n    sessionStorage.setItem(this.#modeKey, this.LIGHT);\n  }\n\n  static #clearMode() {\n    document.documentElement.removeAttribute(this.#modeAttr);\n    sessionStorage.removeItem(this.#modeKey);\n  }\n\n  /**\n   * Notifies other plugins that the theme mode has changed\n   */\n  static #notify() {\n    window.postMessage({ id: this.ID }, '*');\n  }\n}\n\nTheme.init();\n\nexport default Theme;\n"],"names":["Theme","_classCallCheck","_createClass","key","get","_classPrivateGetter","_get_hasMode","_get_mode","_get_sysDark","DARK","LIGHT","value","getThemeMapper","light","dark","_defineProperty","init","_this5","switchable","_assertClassBrand","_darkMedia","_","addEventListener","lastMode","_clearMode","call","visualState","_notify","_get_isDarkMode","_setDark","_setLight","flip","_Theme","_this","sessionStorage","getItem","_modeKey","document","documentElement","getAttribute","_modeAttr","_this2","_this3","_this4","matches","setAttribute","setItem","removeAttribute","removeItem","window","postMessage","id","ID","matchMedia","hasAttribute"],"mappings":"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"}